#!/bin/bash

echo "(* THIS FILE WAS AUTOMATICALLY GENERATED BY CAT'ING LIBRARY SOURCES *)"
echo '[@@@ocaml.warning "-27-32-35"]' # so it builds with default dune settings

for module in $(ocamldep "$@" -sort); do
[[ "$module" == *.mli ]] && continue
modname="$module"
modname=$(basename "$modname" .ml)
modname=$(basename "$modname" .mli)
modname=$(echo "$modname" | awk '{print toupper(substr($0,1,1)) substr($0,2)}')
iface="${module%.ml}.mli"

if [ -f "$iface" ]; then
echo "module ${modname} : sig
$(cat $iface)
end = struct
$(cat $module)
end"

else
echo "module ${modname} = struct
$(cat $module)
end"
fi

done
